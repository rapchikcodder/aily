import{r as h,j as t,c as w,u as ee,R as Y,a as K}from"./useAppStore-CdEbkMje.js";import{t as M}from"./Toast-DJ08JjkF.js";function te({onClick:e,isDark:o,hasText:r}){const[s,i]=h.useState(!1),[a,n]=h.useState(!1),[d,c]=h.useState(!1);return h.useEffect(()=>{const l=setTimeout(()=>i(!0),100);return()=>clearTimeout(l)},[]),h.useEffect(()=>{if(a){const l=setTimeout(()=>c(!0),500);return()=>clearTimeout(l)}else c(!1)},[a]),t.jsxs("div",{className:"relative inline-flex items-center group",children:[d&&t.jsxs("div",{className:w("absolute bottom-full mb-3 left-1/2 -translate-x-1/2 px-4 py-2 rounded-lg text-xs font-medium whitespace-nowrap pointer-events-none","border shadow-md","animate-in fade-in slide-in-from-bottom-2 duration-200",o?"bg-white text-gray-900 border-gray-200":"bg-gray-900 text-white border-gray-700"),children:["Refine this prompt",t.jsx("span",{className:w("absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent",o?"border-t-white":"border-t-gray-900")})]}),t.jsx("button",{onClick:e,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),style:{opacity:s?r?1:.6:0,transform:a?"scale(1.05)":"scale(1)",transition:"opacity 0.3s ease, transform 0.2s ease"},className:w("relative w-10 h-10 rounded-full flex items-center justify-center cursor-pointer","bg-blue-500 hover:bg-blue-600","shadow-md hover:shadow-lg","transition-all duration-200","focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2"),"aria-label":"Refine this prompt with Prompt Architect",title:"Refine this prompt",children:t.jsx("svg",{viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5 text-white","aria-hidden":"true",children:t.jsx("path",{fillRule:"evenodd",d:"M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zm7-10a1 1 0 01.707.293l.828.829A1 1 0 0114 4.828l3.536 3.535a1 1 0 010 1.415L14 13.31a1 1 0 01-.707.293H11a1 1 0 01-.707-.293L6.757 9.775a1 1 0 010-1.414l3.536-3.536A1 1 0 0111 4.532V2a1 1 0 011-1z",clipRule:"evenodd"})})})]})}function re({currentStep:e,totalSteps:o,isDark:r}){const s=Array.from({length:o},(i,a)=>a+1);return t.jsx("div",{className:"flex items-center justify-center gap-2 py-4",children:s.map(i=>{const a=i<e,n=i===e;return t.jsxs("div",{className:w("relative flex items-center justify-center transition-all duration-200",n&&"scale-110"),children:[t.jsx("div",{className:w("w-8 h-8 rounded-full flex items-center justify-center text-xs font-semibold transition-all duration-200",a&&"bg-green-500 text-white",n&&"bg-blue-500 text-white",!a&&!n&&(r?"bg-gray-700 text-gray-400":"bg-gray-200 text-gray-500")),children:i}),i<o&&t.jsx("div",{className:w("absolute left-full w-8 h-0.5 transition-all duration-200",i<e?"bg-green-500":r?"bg-gray-700":"bg-gray-200")})]},i)})})}function oe({question:e,currentIndex:o,total:r,existingAnswer:s,onAnswer:i,onNext:a,onBack:n,onSkip:d,isDark:c}){const[l,p]=h.useState(()=>s?.value??(e.type==="checkbox"?[]:e.type==="scale"?5:"")),[b,y]=h.useState(()=>{if(e.type==="radio"&&typeof s?.value=="string"&&s.value.startsWith("Other: "))return s.value.replace("Other: ","");if(e.type==="checkbox"&&Array.isArray(s?.value)){const u=s.value.find(C=>typeof C=="string"&&C.startsWith("Other: "));return u?u.replace("Other: ",""):""}return""}),v=h.useRef(null);h.useEffect(()=>{setTimeout(()=>v.current?.focus(),100)},[e.id]);const j=()=>{let u=l;if(e.type==="radio"&&l==="Other"&&(b.trim()?u=`Other: ${b.trim()}`:u="Other"),e.type==="checkbox"&&Array.isArray(l)){const P=l.includes("Other"),O=l.filter(q=>q!=="Other");P&&b.trim()?u=[...O,`Other: ${b.trim()}`]:P?u=[...O,"Other"]:u=O}(Array.isArray(u)?u.length===0:u===""||u===null)&&e.required||(i({questionId:e.id,value:u}),a())},f=u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),j())},A=Array.isArray(l)?l.length>0:l!==""&&l!==null;return t.jsxs("div",{className:"h-full flex flex-col card-clean",children:[t.jsx(re,{currentStep:o+1,totalSteps:r,isDark:c}),t.jsxs("div",{className:"flex-1 flex flex-col justify-center px-6 py-4 gap-6 overflow-y-auto",children:[t.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border-2 border-blue-200 dark:border-blue-700 rounded-lg p-6 shadow-sm animate-in fade-in slide-in-from-bottom-4 duration-500",children:t.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 text-center leading-tight",children:e.question})}),e.type==="text"&&t.jsx("textarea",{ref:v,value:l,onChange:u=>p(u.target.value),onKeyDown:f,placeholder:"Type your answer...",rows:4,className:"input-clean resize-none text-sm"}),e.type==="radio"&&t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"flex flex-col gap-2 max-h-56 overflow-y-auto pr-1",children:[e.options?.map(u=>t.jsx("button",{onClick:()=>p(u),className:w("w-full text-left px-4 py-3 rounded-lg border-2 text-sm font-medium transition-all duration-200",l===u?"border-blue-500 bg-blue-500 text-white shadow-sm":"border-gray-200 dark:border-gray-700 hover:border-blue-500 bg-white dark:bg-gray-800"),children:u},u)),t.jsx("button",{onClick:()=>p("Other"),className:w("w-full text-left px-4 py-3 rounded-lg border-2 text-sm font-medium transition-all duration-200",l==="Other"?"border-blue-500 bg-blue-500 text-white shadow-sm":"border-gray-200 dark:border-gray-700 hover:border-blue-500 bg-white dark:bg-gray-800"),children:"Other (please specify)"})]}),l==="Other"&&t.jsx("input",{type:"text",value:b,onChange:u=>y(u.target.value),placeholder:"Please specify...",autoFocus:!0,className:"input-clean text-sm"})]}),e.type==="checkbox"&&t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"flex flex-col gap-2 max-h-56 overflow-y-auto pr-1",children:[e.options?.map(u=>{const C=l.includes(u);return t.jsxs("button",{onClick:()=>{const P=l;p(C?P.filter(O=>O!==u):[...P,u])},className:w("w-full text-left px-4 py-3 rounded-lg border-2 text-sm font-medium transition-all duration-200 flex items-center gap-3",C?"border-blue-500 bg-blue-500 text-white shadow-sm":"border-gray-200 dark:border-gray-700 hover:border-blue-500 bg-white dark:bg-gray-800"),children:[t.jsx("span",{className:w("w-4 h-4 rounded border-2 flex-shrink-0 flex items-center justify-center",C?"border-white bg-transparent":"border-current"),children:C&&t.jsx("svg",{viewBox:"0 0 10 8",className:"w-3 h-3 fill-current",children:t.jsx("path",{d:"M1 4l3 3 5-6",stroke:"currentColor",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})}),t.jsx("span",{children:u})]},u)}),t.jsxs("button",{onClick:()=>{const u=l,C=u.includes("Other");p(C?u.filter(P=>P!=="Other"):[...u,"Other"])},className:w("w-full text-left px-4 py-3 rounded-lg border-2 text-sm font-medium transition-all duration-200 flex items-center gap-3",l.includes("Other")?"border-blue-500 bg-blue-500 text-white shadow-sm":"border-gray-200 dark:border-gray-700 hover:border-blue-500 bg-white dark:bg-gray-800"),children:[t.jsx("span",{className:w("w-4 h-4 rounded border-2 flex-shrink-0 flex items-center justify-center",l.includes("Other")?"border-white bg-transparent":"border-current"),children:l.includes("Other")&&t.jsx("svg",{viewBox:"0 0 10 8",className:"w-3 h-3 fill-current",children:t.jsx("path",{d:"M1 4l3 3 5-6",stroke:"currentColor",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})}),t.jsx("span",{children:"Other (please specify)"})]})]}),l.includes("Other")&&t.jsx("input",{type:"text",value:b,onChange:u=>y(u.target.value),placeholder:"Please specify...",className:"input-clean text-sm"})]}),e.type==="scale"&&t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("input",{ref:v,type:"range",min:1,max:10,value:l,onChange:u=>p(Number(u.target.value)),className:"w-full accent-blue-500"}),t.jsxs("div",{className:"flex justify-between text-xs opacity-60",children:[t.jsx("span",{children:"1"}),t.jsx("span",{className:"text-base font-bold opacity-100",children:l}),t.jsx("span",{children:"10"})]})]})]}),t.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[o>0&&t.jsx("button",{onClick:n,className:"btn-secondary",children:"← Back"}),!e.required&&t.jsx("button",{onClick:d,className:"text-sm opacity-50 hover:opacity-80 transition-opacity underline",children:"Skip"})]}),t.jsxs("button",{onClick:j,disabled:!A&&e.required,className:w("btn-primary","disabled:opacity-50 disabled:cursor-not-allowed"),children:[o===r-1?"Finish":"Next"," →"]})]})]})}const F=h.createContext({activeTab:"",setActiveTab:()=>{}});function ae({defaultValue:e,children:o,className:r}){const[s,i]=h.useState(e);return t.jsx(F.Provider,{value:{activeTab:s,setActiveTab:i},children:t.jsx("div",{className:w("w-full",r),children:o})})}function ne({children:e,className:o}){return t.jsx("div",{className:w("inline-flex items-center justify-center gap-1 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",o),children:e})}function ie({value:e,children:o,className:r}){const{activeTab:s,setActiveTab:i}=h.useContext(F),a=s===e;return t.jsx("button",{onClick:()=>i(e),className:w("px-4 py-2 text-sm font-medium rounded-md transition-all",a?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",r),children:o})}function se({value:e,children:o,className:r}){const{activeTab:s}=h.useContext(F);return s!==e?null:t.jsx("div",{className:w("mt-4",r),children:o})}function le({questions:e,answers:o,onAnswersChange:r,onSubmit:s,isDark:i}){const a=c=>{const l=o.find(p=>p.questionId===c);return typeof l?.value=="string"?l.value:""},n=(c,l)=>{const p=o.findIndex(b=>b.questionId===c);if(p>=0){const b=[...o];b[p]={questionId:c,value:l},r(b)}else r([...o,{questionId:c,value:l}])},d=e.every(c=>a(c.id)!=="");return t.jsxs("div",{className:"h-full flex flex-col card-clean",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"Context Questions"}),t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Answer all ",e.length," questions to generate your mega-prompt"]})]}),t.jsxs(ae,{defaultValue:e[0]?.id??"q1",children:[t.jsx("div",{className:"px-6 py-3 border-b border-gray-200 dark:border-gray-700",children:t.jsx(ne,{className:"w-full grid grid-cols-4 gap-2",children:e.map((c,l)=>{const p=a(c.id)!=="";return t.jsxs(ie,{value:c.id,className:"relative",children:["Q",l+1,p&&t.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white dark:border-gray-800"})]},c.id)})})}),t.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.map(c=>t.jsx(se,{value:c.id,children:t.jsx(ce,{question:c,value:a(c.id),onChange:l=>n(c.id,l),isDark:i})},c.id))})]}),t.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:[t.jsx("button",{onClick:s,disabled:!d,className:w("w-full btn-primary","disabled:opacity-50 disabled:cursor-not-allowed"),children:"Generate Mega-Prompt →"}),!d&&t.jsx("p",{className:"text-xs text-center text-gray-500 dark:text-gray-400 mt-2",children:"Please answer all questions to continue"})]})]})}function ce({question:e,value:o,onChange:r,isDark:s}){const[i,a]=h.useState("");return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border-2 border-blue-200 dark:border-blue-700 rounded-lg p-4",children:t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:e.question})}),t.jsxs("div",{className:"space-y-2",children:[e.options?.map(n=>t.jsx("button",{onClick:()=>r(n),className:w("w-full text-left px-4 py-3 rounded-lg border-2 text-sm font-medium transition-all",o===n?"border-blue-500 bg-blue-500 text-white shadow-sm":"border-gray-200 dark:border-gray-700 hover:border-blue-500 bg-white dark:bg-gray-800"),children:n},n)),t.jsxs("div",{className:"space-y-2",children:[t.jsx("button",{onClick:()=>r("Custom"),className:w("w-full text-left px-4 py-3 rounded-lg border-2 text-sm font-medium transition-all",o.startsWith("Custom")?"border-blue-500 bg-blue-500 text-white shadow-sm":"border-gray-200 dark:border-gray-700 hover:border-blue-500 bg-white dark:bg-gray-800"),children:"Custom (specify below)"}),o.startsWith("Custom")&&t.jsx("input",{type:"text",value:i,onChange:n=>{a(n.target.value),r(`Custom: ${n.target.value}`)},placeholder:"Type your custom answer...",className:"input-clean text-sm w-full",autoFocus:!0})]})]})]})}function de({megaPrompt:e,originalTopic:o,isDark:r,onReplace:s,onAppend:i,onCopy:a,onStartOver:n,onClose:d}){const[c,l]=h.useState(!1),[p,b]=h.useState(e);h.useEffect(()=>{const u=setTimeout(()=>{M.success("Your mega-prompt is ready!")},300);return()=>clearTimeout(u)},[]);const y=()=>{navigator.clipboard.writeText(p).then(()=>{M.success("Copied to clipboard!")}),a()},v=()=>{s(),M.success("Prompt replaced in chat!")},j=()=>{i(),M.success("Prompt appended to chat!")},f=r?"bg-gray-800/50 border-gray-700 text-gray-100":"bg-gray-50/50 border-gray-200 text-gray-800",A=o.length>55?o.slice(0,55)+"...":o;return t.jsxs("div",{className:"flex flex-col h-full",children:[t.jsxs("div",{className:"flex items-start justify-between px-6 pt-5 pb-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-lg font-bold text-green-600 dark:text-green-500",children:"Your Mega-Prompt is Ready!"}),t.jsxs("p",{className:"text-xs mt-1 truncate text-gray-500 dark:text-gray-400",children:['Refined: "',A,'"']})]}),t.jsx("button",{onClick:d,className:"ml-3 flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center text-xl transition-all duration-200 hover:bg-red-500 hover:text-white text-gray-400 hover:scale-110",children:"×"})]}),t.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col px-6 gap-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:"CO-STAR Mega-Prompt"}),t.jsx("button",{onClick:()=>l(u=>!u),className:"text-xs px-3 py-1.5 rounded-lg transition-all duration-200 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 hover:border-blue-500",children:c?"Preview":"Edit"})]}),t.jsx("div",{className:w("rounded-lg max-h-60 overflow-y-auto border-2 border-gray-200 dark:border-gray-700",f),children:c?t.jsx("textarea",{value:p,onChange:u=>b(u.target.value),className:"w-full h-full min-h-[200px] p-4 resize-none outline-none bg-transparent font-mono text-xs leading-relaxed"}):t.jsx("pre",{className:"p-4 whitespace-pre-wrap font-mono text-xs leading-relaxed",children:p})})]}),t.jsxs("div",{className:"px-6 pt-3 pb-2 flex flex-col gap-2",children:[t.jsxs("button",{onClick:v,className:"btn-primary w-full flex items-center justify-center gap-2",children:[t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"Replace Text in Chat"]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:j,className:"btn-secondary flex-1",children:"+ Append"}),t.jsx("button",{onClick:y,className:"btn-secondary flex-1",children:"Copy"})]})]}),t.jsxs("div",{className:"flex items-center justify-center gap-4 px-6 pb-4 pt-1 text-xs text-gray-500 dark:text-gray-400",children:[t.jsx("button",{onClick:n,className:"hover:text-blue-500 transition-colors hover:underline",children:"Start Over"}),t.jsx("span",{children:"•"}),t.jsx("button",{className:"hover:text-blue-500 transition-colors hover:underline",children:"Save to History"})]})]})}function ue({isDark:e}){return t.jsxs("div",{className:"space-y-6 p-6 animate-pulse",children:[t.jsx("div",{className:w("h-1 w-full rounded-full",e?"bg-gray-700":"bg-gray-200")}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:w("h-6 w-3/4 rounded-lg",e?"bg-gray-700":"bg-gray-200")}),t.jsx("div",{className:w("h-6 w-1/2 rounded-lg",e?"bg-gray-700":"bg-gray-200")})]}),t.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(o=>t.jsx("div",{className:w("h-12 w-full rounded-xl",e?"bg-gray-700":"bg-gray-200")},o))})]})}function R({children:e,direction:o="right"}){const[r,s]=h.useState(!1);h.useEffect(()=>{s(!0)},[]);const i={left:r?"translate-x-0":"-translate-x-full",right:r?"translate-x-0":"translate-x-full",up:r?"translate-y-0":"-translate-y-full",down:r?"translate-y-0":"translate-y-full"};return t.jsx("div",{className:w("transition-all duration-500 ease-out",i[o],r?"opacity-100":"opacity-0"),children:e})}const pe=[{trigger:"python",category:"Programming Language",injectedText:`**Python Best Practices:**
- Follow PEP 8 style guide (4-space indentation, snake_case naming)
- Use type hints (e.g., def greet(name: str) -> str:)
- Prefer f-strings for formatting
- Use virtual environments (venv or conda)
- Handle exceptions with specific except clauses
- Write docstrings for public functions and classes`},{trigger:"javascript",category:"Programming Language",injectedText:`**JavaScript Best Practices:**
- Use const/let (never var)
- Prefer async/await over raw Promises
- Use strict equality (===)
- Handle errors with try/catch in async functions
- Follow ESLint + Prettier for code style
- Use ES2020+ features where supported`},{trigger:"typescript",category:"Programming Language",injectedText:`**TypeScript Best Practices:**
- Enable strict mode in tsconfig.json
- Avoid using 'any' — use 'unknown' for truly unknown types
- Define explicit return types for public functions
- Use interface for object shapes, type for unions/aliases
- Leverage discriminated unions for state modeling
- Use Zod or similar for runtime validation`},{trigger:"react",category:"Framework",injectedText:`**React Best Practices:**
- Use functional components + hooks (never class components for new code)
- Keep components small and single-responsibility
- Lift state only as high as necessary
- Memoize expensive calculations with useMemo
- Use useCallback for stable function references passed to children
- Prefer composition over prop-drilling; use Context sparingly`},{trigger:"next.js",category:"Framework",injectedText:`**Next.js Best Practices:**
- Use the App Router (app/ directory) for new projects
- Prefer Server Components; use 'use client' only when needed
- Use Server Actions for form handling and mutations
- Leverage ISR or dynamic rendering based on data freshness needs
- Use next/image for all images (automatic optimization)
- Store secrets in .env.local (never commit to git)`},{trigger:"django",category:"Framework",injectedText:`**Django Best Practices:**
- Follow the Fat Models, Thin Views pattern
- Use Django REST Framework for APIs
- Keep settings split: base.py, development.py, production.py
- Use select_related / prefetch_related to avoid N+1 queries
- Write model-level validation, not just form-level
- Use Django's built-in auth system; extend AbstractUser if needed`},{trigger:"healthcare",category:"Industry",injectedText:`**Healthcare Compliance Context:**
- HIPAA compliance is mandatory for any PHI (Protected Health Information)
- Data encryption required at rest and in transit
- Audit trails must be maintained for all PHI access
- Minimum necessary principle: only access data required for the task
- Business Associate Agreements (BAA) required with third-party vendors
- Consider HL7 FHIR standards for health data interoperability`},{trigger:"finance",category:"Industry",injectedText:`**Financial Compliance Context:**
- PCI-DSS compliance required for payment card data
- SOX compliance for publicly traded companies (audit trails, internal controls)
- GDPR / CCPA considerations for customer financial data
- Data residency requirements may restrict where data is stored
- Immutable transaction logs are a regulatory requirement
- Consider FINRA regulations for investment-related features`},{trigger:"education",category:"Industry",injectedText:`**Education Context:**
- FERPA compliance required for student educational records (US)
- COPPA compliance if serving users under 13
- Accessibility (WCAG 2.1 AA) is both a legal and ethical requirement
- Consider diverse learning styles: visual, auditory, kinesthetic
- Design for varying tech literacy levels (students, teachers, admins)
- Offline-first approach benefits low-connectivity environments`},{trigger:"academic",category:"Writing Style",injectedText:`**Academic Writing Standards:**
- Use formal, objective tone — avoid first person unless specified
- Support all claims with citations (APA, MLA, or Chicago style)
- Define technical terms before first use
- Use passive voice judiciously (active generally preferred now)
- Structure: Introduction → Literature Review → Methodology → Results → Discussion → Conclusion
- Avoid contractions and colloquialisms`},{trigger:"beginner",category:"Audience Level",injectedText:`**Beginner Audience Guidelines:**
- Avoid jargon; when technical terms are unavoidable, define them immediately
- Use analogies to familiar, everyday concepts
- Short paragraphs and sentences (max 20 words per sentence as a guide)
- Include step-by-step instructions with numbered lists
- Anticipate confusion points and address them proactively
- Use encouraging, supportive tone`},{trigger:"expert",category:"Audience Level",injectedText:`**Expert Audience Guidelines:**
- Assume deep domain knowledge — skip introductory context
- Use precise technical terminology without definition
- Focus on nuance, edge cases, and advanced patterns
- Reference relevant standards, papers, or established best practices
- Be concise — experts value density of information
- Welcome debate and alternative approaches`}];function ge(e,o=[]){const r=[...pe,...o],s=[],i=new Set,a=e.flatMap(n=>Array.isArray(n.value)?n.value:[String(n.value)]).join(" ").toLowerCase();for(const n of r){if(i.has(n.trigger))continue;const d=n.trigger.toLowerCase().replace(/[.*+?^${}()|[\]\\]/g,"\\$&");new RegExp(`\\b${d}\\b`,"i").test(a)&&(s.push(n),i.add(n.trigger))}return s}function me(e){return e.length===0?"":`

---
## Additional Context (Auto-Injected)

${e.map(r=>r.injectedText).join(`

`)}`}const he={writing:["write","draft","email","letter","message","article","blog","essay","document","report","memo","note","respond","reply","communicate"],coding:["code","program","develop","build","implement","fix","debug","refactor","function","app","website","api","script","bug","error","test"],marketing:["marketing","campaign","strategy","launch","promote","brand","audience","advertising","content","social","seo","growth","engagement","conversion"],design:["design","ui","ux","interface","layout","mockup","prototype","wireframe","visual","graphic","logo","branding","style","aesthetic"],analysis:["analyze","research","plan","strategy","evaluate","assess","review","compare","investigate","study","examine","understand","explore"]};function be(e){const o=e.toLowerCase(),r={writing:0,coding:0,marketing:0,design:0,analysis:0};for(const[i,a]of Object.entries(he))for(const n of a)o.includes(n)&&r[i]++;const s=Object.entries(r);return s.sort((i,a)=>a[1]-i[1]),s[0][1]>0?s[0][0]:"writing"}const ye={email:["email","message","letter","reply","respond","mail"],document:["document","doc","report","memo","article","blog","essay","write"],plan:["plan","roadmap","timeline","schedule","outline","strategy"],code:["code","function","script","program","app","implement","build","debug","fix"],prompt:["prompt","instruction","template","guideline"],strategy:["strategy","campaign","approach","framework","methodology"],script:["script","automation","workflow","pipeline"],other:[]};function fe(e){const o=e.toLowerCase(),r={email:0,document:0,plan:0,code:0,prompt:0,strategy:0,script:0,other:0};for(const[i,a]of Object.entries(ye))for(const n of a)o.includes(n)&&r[i]++;const s=Object.entries(r);return s.sort((i,a)=>a[1]-i[1]),s[0][1]>0?s[0][0]:"other"}function we(){return`You are a master prompt engineer. Compile interview answers into a comprehensive, detailed CO-STAR mega-prompt that is ready to paste into Claude or ChatGPT.

<role>
You transform raw Q&A data into a rich, actionable mega-prompt that maximizes AI output quality.
You include all relevant context, constraints, and requirements to ensure the AI produces exactly what the user needs.
Every section should be detailed and specific, not just high-level summaries.
</role>

<rules>
- Transform the Interview Q&A into a detailed, comprehensive mega-prompt
- Include ALL important information from the answers - don't compress or summarize too aggressively
- Be specific and concrete - avoid vague language like "as needed" or "appropriate"
- If an answer provides context, examples, or constraints, include them in detail
- Aim for 800-1500 words for comprehensive coverage - DO NOT truncate or cut off mid-sentence
- CRITICAL: Complete ALL sections fully. Never stop mid-sentence or mid-section
- If answers conflict or essential info is missing, add 2–5 "Open Questions" at the end
- Output in clear, well-formatted markdown
- Make each section substantive - avoid single-sentence sections
- Expand on user answers with relevant context and implications
- Write complete sentences and complete all sections before finishing
</rules>

<reasoning_scaffolding>
Before generating the final output:
1. Outline approach: What are ALL the key decisions, constraints, and requirements from the Q&A?
2. Verify constraints: Are there must-include/must-avoid elements, style preferences, examples?
3. Identify context: What background information, audience details, or domain knowledge is provided?
4. Expand implications: What does each answer imply about quality, scope, or approach?
5. Produce final output: Compile into detailed CO-STAR format with comprehensive sections.

Think through these steps internally, but only output the final mega-prompt.
</reasoning_scaffolding>

<format>
### CO-STAR Mega-Prompt: {title}

**Context:**
[Write 3-5 complete sentences. Include detailed background, situation, and relevant information. Include domain context, current state, and any provided examples. DO NOT truncate.]

**Objective:**
[Write 3-4 complete sentences. Provide clear, specific goal statements. What exactly should be produced? Include scope, deliverables, and success criteria. DO NOT truncate.]

**Style:**
[Write 3-5 complete sentences. Detail style requirements: formatting, structure, length, technical depth, examples to follow, etc. Be specific about what "good" looks like. DO NOT truncate.]

**Tone:**
[Write 2-3 complete sentences. Describe voice and attitude: formal/casual, friendly/professional, encouraging/direct, etc. Include any specific language preferences. DO NOT truncate.]

**Audience:**
[Write 2-4 complete sentences. Who will consume this? Their background, expertise level, expectations, and what they need to understand or do with the output. DO NOT truncate.]

**Response Requirements:**
[Write a comprehensive bulleted list with 8-15 specific items. Include ALL of these categories:]
- Format and structure requirements (2-3 bullets)
- Content requirements and constraints (2-3 bullets)
- Quality standards and success criteria (1-2 bullets)
- Any examples, edge cases, or special considerations (1-2 bullets)
- Technical requirements or dependencies (1-2 bullets)
- Length, depth, or scope guidelines (1 bullet)
- Delivery format and presentation (1 bullet)
[DO NOT truncate this list - complete ALL bullets]

**Open Questions (if needed):**
[Any ambiguities, missing information, or choices the AI should clarify before proceeding]
- [List 2-5 questions if needed, or write "None" if everything is clear]

IMPORTANT: Finish writing the ENTIRE mega-prompt. Do not stop mid-sentence or leave any section incomplete.
</format>`}function xe(e,o,r,s){const i=o.map(a=>`Q: ${r.find(d=>d.id===a.questionId)?.question??a.questionId}
A: ${Array.isArray(a.value)?a.value.join(", "):a.value}`).join(`

`);return`<original_goal>
"${e}"
</original_goal>

<decision_inputs>
Interview Q&A:
${i}

Auto-injected context blocks:
${s}
</decision_inputs>

Compile into CO-STAR mega-prompt now.`}function ve(e,o){if(e.filter(a=>{if(typeof a.value=="string"){const n=a.value.toLowerCase().trim();return n.length<10||n==="not sure"||n==="maybe"||n==="idk"||n==="n/a"}return!1}).length>=2)return{needsCritic:!0,reason:"Multiple vague answers detected"};if(o.filter(a=>a.required&&!e.find(n=>n.questionId===a.id)).length>0)return{needsCritic:!0,reason:"Missing required information"};const i=e.filter(a=>o.find(d=>d.id===a.questionId)?.dimension==="constraints");if(i.length>1){const a=i.map(d=>Array.isArray(d.value)?d.value.join(" "):String(d.value)).join(" ").toLowerCase();if(a.includes("formal")&&a.includes("casual")||a.includes("short")&&a.includes("long")||a.includes("technical")&&a.includes("simple"))return{needsCritic:!0,reason:"Potential conflicting constraints"}}return{needsCritic:!1}}function ke(){return`You are a prompt quality critic. Your job is to improve an existing mega-prompt for clarity and specificity without changing the user's intent.

<role>
You refine prompts by:
- Removing ambiguity
- Adding missing critical details when inferable
- Improving structure for better AI comprehension
- Maintaining the original goal and constraints
</role>

<rules>
- Do NOT change the user's original intent or goal.
- Do NOT add features or requirements that weren't requested.
- Do improve clarity, specificity, and actionability.
- Keep the length similar (~250-400 words).
- Output the improved mega-prompt in the same CO-STAR format.
</rules>`}function je(e,o){return`<original_mega_prompt>
${e}
</original_mega_prompt>

<improvement_context>
This prompt needs improvement because: ${o}
</improvement_context>

Improve the mega-prompt for clarity and specificity while maintaining the original intent.`}function Ae(){return`You are an adaptive Socratic interviewer.

<role>
Your job is to ask the single best NEXT question, or decide the interview is done.
You adapt based on what has already been asked and answered.
</role>

<rules>
- Ask ONE question only, OR return done=true.
- Do NOT change the user's goal.
- Do NOT propose solutions.
- Do NOT assume facts.
- Choose a dimension ONLY from the RemainingDimensions list provided.
- Do NOT repeat a dimension that was already asked.
- Prioritize highest information gain: what would most change the final output?
</rules>

<output_schema>
Return valid JSON only with one of these forms:

A) Ask next question:
{
  "done": false,
  "question": {
    "id": "qN",
    "dimension": "deliverable|audience|inputs|constraints|style_tone",
    "question": "...",
    "type": "radio|checkbox|text|scale",
    "options": ["..."],
    "required": true
  }
}

B) Interview complete:
{
  "done": true,
  "reason": "Already have sufficient information to produce high-quality output"
}
</output_schema>

<constraints>
- dimension must be one of RemainingDimensions
- radio/checkbox must include options with >= 2 items
- text/scale must not include options
- scale must define endpoints in question text (e.g., "1=formal, 10=casual")
</constraints>

<self_check>
Before outputting, verify:
- JSON is valid
- If done=false: question object is complete with all required fields
- If done=true: reason is clear and specific
- dimension is from RemainingDimensions list
- radio/checkbox has options array
</self_check>`}function Ce(e){const{topic:o,askedQuestions:r,answers:s,remainingDims:i,taskFamily:a,deliverableType:n,missingCritical:d,minQ:c,maxQ:l}=e,p=r.length>0?r.map((y,v)=>`${v+1}. [${y.dimension}] ${y.question}`).join(`
`):"None yet",b=s.length>0?s.map(y=>{const v=r.find(f=>f.id===y.questionId);if(!v)return"";const j=Array.isArray(y.value)?y.value.join(", "):String(y.value);return`Q: ${v.question}
A: ${j}`}).filter(Boolean).join(`

`):"No answers yet";return`<topic>
${o}
</topic>

<interview_state>
Already asked questions (${r.length}/${l}):
${p}

Answers so far:
${b}
</interview_state>

<interview_bounds>
- MinQuestions: ${c}
- MaxQuestions: ${l}
- Currently at: ${r.length} questions
</interview_bounds>

<remaining_dimensions>
You MUST pick from these dimensions only:
${JSON.stringify(i)}
</remaining_dimensions>

<intent_hints>
Task Family: ${a}
Expected Deliverable: ${n}
Critical Missing Dimensions: ${JSON.stringify(d)}
</intent_hints>

<task>
Based on the Q&A history and remaining dimensions, either:
- Return the single best next question (Form A), OR
- Return done=true (Form B) if we already have enough to produce quality output

Focus on the critical missing dimensions first, then fill in nice-to-have information.
</task>`}function Ne(){return`You are an expert Prompt Architect.

<role>Analyze the user's vague topic, determine its core domain (coding, lifestyle, creative, business, etc.), and identify the 3 to 4 absolute most critical missing context variables.</role>

<rules>
1. Generate EXACTLY 3 or 4 questions.
2. Questions must target "Highest Information Gain"
3. DO NOT ask what they want to make (they already told you). Ask HOW, FOR WHOM, or UNDER WHAT CONSTRAINTS.
4. Keep questions extremely concise and punchy.
5. Provide 3-5 specific multiple-choice options for each question (UI will add 'Custom' text box)
</rules>

<output_schema>
{
  "genre": "string (e.g., 'Creative Writing', 'Software Dev')",
  "questions": [
    {
      "id": "q1",
      "focus": "string (e.g., 'Target Audience', 'Tech Stack')",
      "question": "string",
      "options": ["option 1", "option 2", "option 3", "option 4"]
    }
  ]
}
</output_schema>`}function Te(e){return`<topic>
"${e}"
</topic>

Generate the context questions now.`}function Se(){return{type:"object",required:["genre","questions"],properties:{genre:{type:"string",description:"The detected domain/genre (e.g., Creative Writing, Software Dev)"},questions:{type:"array",minItems:3,maxItems:4,items:{type:"object",required:["id","focus","question","options"],properties:{id:{type:"string",description:"Question ID (q1, q2, q3, q4)"},focus:{type:"string",description:"What this question is targeting (e.g., Target Audience, Tech Stack)"},question:{type:"string",description:"The actual question text"},options:{type:"array",minItems:3,maxItems:5,items:{type:"string"},description:"Multiple choice options (3-5 items)"}},additionalProperties:!1}}},additionalProperties:!1}}function Pe(){return`You are a master Prompt Engineer. Your task is to compile a user's original vague idea and their clarifying answers into a professional, highly optimized Mega-Prompt.

<role>Transform raw Q&A data into a dense, actionable prompt that leaves zero ambiguity for the final AI.</role>

<rules>
1. Use CO-STAR framework
2. DO NOT write fluff. Be specific, concrete, and directive.
3. Scale the length to match task complexity
4. Output ONLY the compiled Mega-Prompt in markdown
</rules>

<format>
### Context
### Objective
### Style & Tone
### Audience
### Response Requirements
</format>`}function Oe(e,o,r){const s=o.map(i=>{const a=r.find(d=>d.id===i.questionId),n=Array.isArray(i.value)?i.value.join(", "):String(i.value);return`Q: ${a?.question??i.questionId}
A: ${n}`}).join(`

`);return`<original_idea>
"${e}"
</original_idea>

<clarifying_qa>
${s}
</clarifying_qa>

Compile the Mega-Prompt now.`}function Ie(e){const o=e.match(/\{[^{}]*(?:\{[^{}]*\}[^{}]*)*\}/);return o?o[0]:null}function Ee(e){try{return JSON.parse(e)}catch{return null}}function qe(e,o){const r=[];(!e.id||typeof e.id!="string")&&r.push("Question must have a valid id (string)"),(!e.question||typeof e.question!="string")&&r.push("Question must have a valid question text (string)"),(!e.dimension||typeof e.dimension!="string")&&r.push("Question must have a valid dimension (string)"),(!e.type||!["text","radio","checkbox","scale"].includes(e.type))&&r.push("Question type must be: text, radio, checkbox, or scale");const s=["deliverable","audience","inputs","constraints","style_tone"];return e.dimension&&!s.includes(e.dimension)&&r.push(`Invalid dimension "${e.dimension}". Must be one of: ${s.join(", ")}`),e.dimension&&o.includes(e.dimension)&&r.push(`Dimension "${e.dimension}" has already been asked`),(e.type==="radio"||e.type==="checkbox")&&(!Array.isArray(e.options)||e.options.length<2)&&r.push(`Question type "${e.type}" must have options array with at least 2 items`),(e.type==="text"||e.type==="scale")&&e.options&&r.push(`Question type "${e.type}" should not have options`),r}function Re(e,o,r,s){const i=[];if(typeof e.done!="boolean")return i.push('Response must have a "done" field (boolean)'),i;if(e.done===!1){if(!e.question||typeof e.question!="object")return i.push('When done=false, response must include a "question" object'),i;const a=o.map(d=>d.dimension),n=qe(e.question,a);i.push(...n)}else(!e.reason||typeof e.reason!="string")&&i.push('When done=true, response should include a "reason" string'),o.length<r&&i.push(`Cannot stop with only ${o.length} questions (min is ${r})`);return i}function $e(e,o,r){const s=be(e),i=fe(e),a={deliverable:!1,audience:!1,inputs:!1,constraints:!1,style_tone:!1};for(const c of o)c.dimension&&(a[c.dimension]=!0);const n=[];switch(s){case"coding":a.inputs||n.push("inputs"),a.constraints||n.push("constraints"),a.deliverable||n.push("deliverable");break;case"writing":a.deliverable||n.push("deliverable"),a.audience||n.push("audience"),a.constraints||n.push("constraints");break;case"marketing":a.deliverable||n.push("deliverable"),a.audience||n.push("audience"),a.constraints||n.push("constraints");break;case"design":a.deliverable||n.push("deliverable"),a.constraints||n.push("constraints"),a.audience||n.push("audience");break;case"analysis":a.inputs||n.push("inputs"),a.deliverable||n.push("deliverable"),a.constraints||n.push("constraints");break}let d=.5;return i!=="other"&&(d=.7),a.deliverable&&r.find(l=>o.find(b=>b.id===l.questionId)?.dimension==="deliverable")&&(d=.9),{taskFamily:s,deliverableHint:{kind:i,confidence:d},knownDimensions:a,missingCritical:n}}function Me(e){const o=["deliverable","audience","inputs","constraints","style_tone"],r=new Set(e.map(s=>s.dimension));return o.filter(s=>!r.has(s))}function Le(e){const{asked:o,minQ:r,maxQ:s,remainingDims:i,intent:a}=e;return o.length>=s?{stop:!0,reason:`Reached maximum questions (${s})`}:o.length<r?{stop:!1}:a.missingCritical.every(d=>!i.includes(d))?{stop:!0,reason:"All critical dimensions covered"}:i.length===1&&i[0]==="style_tone"&&a.knownDimensions.deliverable&&a.knownDimensions.audience?{stop:!0,reason:"Only optional style_tone dimension remains"}:i.length===0?{stop:!0,reason:"No remaining dimensions to ask"}:{stop:!1}}async function De(e,o){const r=window;if(!r.ai?.languageModel)throw new Error("Local AI (window.ai) is not available");const s=await r.ai.languageModel.create({systemPrompt:e}),i=await s.prompt(o);return s.destroy(),i}async function D(e,o,r=.7,s=2048){if(e.provider==="local"){const i=o.find(n=>n.role==="system"),a=o.find(n=>n.role==="user");if(!i||!a)throw new Error("Invalid message format: must have system and user messages");try{return await De(i.content,a.content)}catch(n){if(console.warn("[AI Engine] Local AI failed, falling back to cloud provider:",n.message),typeof chrome>"u"||!chrome.storage||!chrome.storage.local)throw new Error("Local AI is not available and Chrome storage is not accessible for cloud fallback");const c=(await chrome.storage.local.get(["apiKeys"])).apiKeys??{};let l=null;if(c.gemini?l="gemini":c.grok?l="grok":c.openai?l="openai":c.anthropic&&(l="anthropic"),!l)throw new Error("Local AI is not available. Please add a cloud API key in Settings (Gemini is free!)");console.log(`[AI Engine] Falling back to ${l}`);const p=await chrome.runtime.sendMessage({type:"AI_RAW_COMPLETE",payload:{provider:l,messages:o,temperature:r,maxTokens:s}});if(!p.ok)throw new Error(p.error||"Cloud AI fallback failed");return p.text}}else{if(typeof chrome>"u"||!chrome.runtime)throw new Error("Chrome runtime not available");const i=await chrome.runtime.sendMessage({type:"AI_RAW_COMPLETE",payload:{provider:e.provider,messages:o,temperature:r,maxTokens:s}});if(!i.ok)throw new Error(i.error||"AI completion failed");return i.text}}async function U(e,o,r,s,i=3,a=5){const n=$e(e,o,r),d=Me(o);console.log(`[AI Engine] Generating next question (${o.length+1}/${i}-${a})`),console.log(`[Intent] Task: ${n.taskFamily}, Deliverable: ${n.deliverableHint.kind}`),console.log(`[Intent] Missing critical: ${JSON.stringify(n.missingCritical)}`);const c=Le({asked:o,minQ:i,maxQ:a,remainingDims:d,intent:n});if(c.stop)return console.log(`[Policy] Stop - ${c.reason}`),{done:!0,reason:c.reason};console.log(`[Policy] Continue - ${d.length} dimensions remaining`);const l=Ae(),p=Ce({topic:e,askedQuestions:o,answers:r,remainingDims:d,taskFamily:n.taskFamily,deliverableType:n.deliverableHint.kind,missingCritical:n.missingCritical,minQ:i,maxQ:a});let b=await D(s,[{role:"system",content:l},{role:"user",content:p}],.7,2048),y=0;const v=1;for(;y<=v;){const j=Ie(b);if(!j){if(y>=v)throw new Error("AI did not return valid JSON object");y++;continue}const f=Ee(j);if(!f){if(y>=v)throw new Error("AI returned malformed JSON");y++;continue}const A=Re(f,o,i);if(A.length>0&&y<v){console.warn("[AI Engine] Validation failed, retrying...",A);const u=`${l}

<repair>
Previous output had errors:
${A.join(`
`)}

Fix these errors and return valid JSON.
</repair>`;b=await D(s,[{role:"system",content:u},{role:"user",content:p}],.7,2048),y++;continue}else if(A.length>0)throw new Error(`Validation failed: ${A.join(", ")}`);return f.done?(console.log("[AI Engine] Interview complete:",f.reason),{done:!0,reason:f.reason||"AI decided we have enough information"}):(console.log(`[AI Engine] Next question: [${f.question.dimension}] ${f.question.question.substring(0,50)}...`),{done:!1,question:{id:f.question.id||`q${o.length+1}`,question:f.question.question,dimension:f.question.dimension,type:f.question.type||"text",options:f.question.options||[],required:f.question.required!==!1}})}throw new Error("Failed to generate next question after retries")}async function _(e,o,r,s){const i=ge(r,s.customVariables??[]),a=me(i),n=we(),d=xe(e,r,o,a);let c=await D(s,[{role:"system",content:n},{role:"user",content:d}],.7,8192);c=c.trim();const{needsCritic:l,reason:p}=ve(r,o);if(l&&p){console.log(`[AI Engine] Running critic step: ${p}`);try{const b=ke(),y=je(c,p);c=(await D(s,[{role:"system",content:b},{role:"user",content:y}],.7,8192)).trim(),console.log("[AI Engine] Critic step completed successfully")}catch(b){console.warn("[AI Engine] Critic step failed, using original mega-prompt",b)}}else console.log("[AI Engine] Skipping critic step (not needed)");return c}async function ze(){try{const e=window;return!("ai"in e)||!("languageModel"in e.ai)?!1:(await e.ai.languageModel.capabilities()).available==="readily"}catch{return!1}}async function _e(e){if(e.provider==="openai"&&e.apiKey)return e.apiKey;if(typeof chrome>"u"||!chrome.storage||!chrome.storage.local)throw new Error("Chrome storage not available");const r=(await chrome.storage.local.get(["apiKeys"])).apiKeys??{};if(r.openai)return r.openai;throw new Error("OpenAI API key not found. Please add it in Settings.")}async function Ve(e){if(e.provider==="anthropic"&&e.apiKey)return e.apiKey;if(typeof chrome>"u"||!chrome.storage||!chrome.storage.local)throw new Error("Chrome storage not available");const r=(await chrome.storage.local.get(["apiKeys"])).apiKeys??{};if(r.anthropic)return r.anthropic;throw new Error("Anthropic API key not found. Please add it in Settings.")}async function Fe(e,o){console.log("[V3 Stage 1] Generating context questions...");const r=await _e(o),s=Ne(),i=Te(e),a=Se(),n=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({model:"gpt-4o-mini",temperature:.2,messages:[{role:"system",content:s},{role:"user",content:i}],response_format:{type:"json_schema",json_schema:{name:"context_questions",strict:!0,schema:a}}})});if(!n.ok){const p=await n.json().catch(()=>({}));throw new Error(`OpenAI error: ${p?.error?.message??n.statusText}`)}const d=await n.json(),c=JSON.parse(d.choices[0].message.content);if(console.log("[V3 Stage 1] Response:",c),!c.genre||typeof c.genre!="string")throw new Error("Invalid response: missing or invalid genre");if(!Array.isArray(c.questions))throw new Error("Invalid response: questions must be array");if(c.questions.length<3||c.questions.length>4)throw new Error(`Invalid response: expected 3-4 questions, got ${c.questions.length}`);const l=c.questions.map((p,b)=>({id:p.id||`q${b+1}`,question:p.question,type:"radio",dimension:p.focus?.toLowerCase().replace(/\s+/g,"_")||"constraints",options:p.options||[],required:!0}));return console.log("[V3 Stage 1] Generated",l.length,"questions"),{genre:c.genre,questions:l}}async function Be(e,o,r,s){console.log("[V3 Stage 2] Compiling mega-prompt...");const i=await Ve(s),a=Pe(),n=Oe(e,r,o),d=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":i,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:"claude-3-5-sonnet-20241022",max_tokens:2e3,system:a,messages:[{role:"user",content:n}]})});if(!d.ok){const p=await d.json().catch(()=>({}));throw new Error(`Anthropic error: ${p?.error?.message??d.statusText}`)}const l=(await d.json()).content[0].text;if(!l||l.trim().length<100)throw new Error("Invalid mega-prompt: too short or empty");return console.log("[V3 Stage 2] Compiled mega-prompt:",l.length,"characters"),l.trim()}async function L(){try{if(typeof chrome>"u"||!chrome.storage||!chrome.storage.local)return console.warn("[InterviewOverlay] Chrome storage not available, using local provider"),{provider:"local"};const e=await chrome.storage.local.get(["apiKeys","aiProvider"]),o=e.aiProvider??"local",r=e.apiKeys??{};return{provider:o,apiKey:o==="openai"?r.openai:o==="anthropic"?r.anthropic:o==="gemini"?r.gemini:o==="grok"?r.grok:void 0}}catch(e){return console.error("[InterviewOverlay] Error loading AI config:",e),{provider:"local"}}}function We({topic:e,isDark:o,onClose:r,onReplaceText:s,onAppendText:i}){const[a,n]=h.useState("loading"),[d,c]=h.useState([]),[l,p]=h.useState([]),[b,y]=h.useState(0),[v,j]=h.useState(""),[f,A]=h.useState(""),[u,C]=h.useState(0),[P,O]=h.useState(!1),[q,g]=h.useState(""),[k,T]=h.useState(0),[H,B]=h.useState(!1),z=ee(m=>m.v3Enabled);h.useEffect(()=>{let m=!1;async function N(){try{const x=await L();if(z){console.log("[V3] Starting interview for:",e);const I=await Fe(e,x);if(m)return;c(I.questions),n("interview"),console.log("[V3] Generated",I.questions.length,"questions")}else{if(x.provider==="local"&&!await ze()){const E=(typeof chrome<"u"&&chrome.storage&&chrome.storage.local?await chrome.storage.local.get(["apiKeys"]):{apiKeys:{}}).apiKeys??{};if(E.gemini)x.provider="gemini",x.apiKey=E.gemini;else if(E.grok)x.provider="grok",x.apiKey=E.grok;else if(E.openai)x.provider="openai",x.apiKey=E.openai;else if(E.anthropic)x.provider="anthropic",x.apiKey=E.anthropic;else{A("No AI provider available. Please add an API key in Settings."),n("error");return}}const I=await U(e,[],[],x,3,5);if(m)return;if(I.done){n("compiling");const W=await _(e,[],[],x);if(m)return;j(W),n("result")}else c([I.question]),y(0),n("interview")}}catch(x){m||(A(x.message??"Failed to generate questions. Please try again."),n("error"))}}return N(),()=>{m=!0}},[e,u,z]),h.useEffect(()=>{const m=N=>{N.key==="Escape"&&r()};return document.addEventListener("keydown",m),()=>document.removeEventListener("keydown",m)},[r]);const Q=h.useCallback(m=>{p(N=>{const x=N.findIndex(I=>I.questionId===m.questionId);if(x>=0){const I=[...N];return I[x]=m,I}return[...N,m]})},[]),G=h.useCallback(async()=>{console.log("[V3] Submitting answers, compiling mega-prompt..."),n("compiling");try{const m=await L(),N=await Be(e,d,l,m);j(N),n("result"),console.log("[V3] Mega-prompt compiled successfully")}catch(m){A(m.message??"Failed to compile mega-prompt. Please try again."),n("error")}},[e,d,l]),$=h.useCallback(async()=>{if(b<d.length-1){y(m=>m+1);return}O(!0),g("");try{const m=await L(),N=await U(e,d,l,m,3,5);if(N.done){O(!1),n("compiling");const x=await _(e,d,l,m);j(x),n("result")}else c(x=>[...x,N.question]),y(x=>x+1),T(0),O(!1)}catch(m){g(m.message??"Failed to generate next question"),T(N=>N+1),O(!1),k>=1&&B(!0)}},[b,d,l,e,k]),J=h.useCallback(()=>{y(m=>Math.max(0,m-1))},[]),X=h.useCallback(()=>{$()},[$]),Z=h.useCallback(async()=>{O(!1),g(""),B(!1),n("compiling");try{const m=await L(),N=await _(e,d,l,m);j(N),n("result")}catch(m){A(m.message??"Failed to compile prompt. Please try again."),n("error")}},[e,d,l]);return t.jsx("div",{className:"absolute inset-0 flex items-center justify-center animate-in fade-in duration-300 bg-black/50",style:{pointerEvents:"auto"},onClick:m=>{m.target===m.currentTarget&&r()},children:t.jsx("div",{className:"w-[520px] max-h-[600px] overflow-hidden animate-in zoom-in slide-in-from-bottom-4 duration-500",onClick:m=>m.stopPropagation(),children:t.jsxs("div",{className:"h-full flex flex-col relative card-clean",children:[(a==="loading"||a==="compiling"||a==="error")&&t.jsx("button",{onClick:r,className:"absolute top-4 right-4 w-8 h-8 rounded-full flex items-center justify-center text-xl transition-all duration-300 hover:bg-red-500 hover:text-white text-gray-400 hover:scale-110 z-20",children:"×"}),a==="loading"&&t.jsx(R,{direction:"down",children:t.jsx(ue,{isDark:o})}),a==="interview"&&t.jsxs(t.Fragment,{children:[z?t.jsx(le,{questions:d,answers:l,onAnswersChange:p,onSubmit:G,isDark:o}):d[b]&&t.jsx(R,{direction:"right",children:t.jsx(oe,{question:d[b],currentIndex:b,total:d.length,existingAnswer:l.find(m=>m.questionId===d[b].id),onAnswer:Q,onNext:$,onBack:J,onSkip:X,isDark:o})},b),P&&t.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center z-20",children:t.jsxs("div",{className:"p-6 flex flex-col items-center gap-3 card-clean",children:[t.jsx("div",{className:"w-12 h-12 border-4 border-gray-200 dark:border-gray-700 border-t-blue-500 rounded-full animate-spin"}),t.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:"Thinking of next question..."})]})}),q&&!P&&t.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center z-20",children:t.jsxs("div",{className:"p-6 max-w-sm text-center card-clean",children:[t.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border-2 border-red-200 dark:border-red-700 rounded-lg p-4 shadow-sm mb-4",children:t.jsx("p",{className:"text-sm font-medium text-red-600 dark:text-red-400",children:q})}),t.jsxs("div",{className:"flex gap-2 justify-center",children:[t.jsx("button",{onClick:()=>{g(""),$()},className:"btn-primary",children:"Retry"}),H&&t.jsx("button",{onClick:Z,className:"px-4 py-2 rounded-lg bg-green-500 hover:bg-green-600 text-white text-sm font-medium transition-all duration-200 shadow-sm hover:shadow-md",children:"Continue with Current Answers"})]})]})})]}),a==="compiling"&&t.jsx(R,{direction:"up",children:t.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center gap-6 p-12",children:[t.jsx("div",{className:"w-16 h-16 border-4 border-gray-200 dark:border-gray-700 border-t-blue-500 rounded-full animate-spin"}),t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border-2 border-blue-200 dark:border-blue-700 rounded-lg p-6 shadow-sm text-center max-w-md",children:[t.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:"Crafting your mega-prompt..."}),t.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"This usually takes 3-5 seconds"})]})]})}),a==="result"&&t.jsxs(R,{direction:"up",children:[t.jsx("div",{className:"absolute top-4 right-4 w-12 h-12 z-20",children:t.jsx("div",{className:"w-full h-full rounded-full bg-green-500 flex items-center justify-center text-white text-2xl animate-in zoom-in duration-500 shadow-md",children:"✓"})}),t.jsx(de,{megaPrompt:v,originalTopic:e,isDark:o,onReplace:()=>{s(v),r()},onAppend:()=>{i(v),r()},onCopy:()=>{},onStartOver:()=>{n("loading"),p([]),y(0)},onClose:r})]}),a==="error"&&t.jsx(R,{direction:"down",children:t.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center gap-5 p-10 text-center",children:[t.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border-2 border-red-200 dark:border-red-700 rounded-lg p-6 shadow-sm max-w-md",children:t.jsx("p",{className:"text-lg font-semibold text-red-600 dark:text-red-400",children:f})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:()=>{p([]),y(0),C(m=>m+1),n("loading")},className:"btn-primary",children:"Retry"}),t.jsx("button",{onClick:r,className:"btn-secondary",children:"Close"})]}),f.includes("API key")&&t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Open the extension popup → Settings to add your API key."})]})})]})})})}function Ye(e){const o=Object.getOwnPropertyDescriptor(e.tagName==="TEXTAREA"?HTMLTextAreaElement.prototype:HTMLElement.prototype,"value")?.set;o&&o.call(e,e.value),e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0}))}const Ke={id:"chatgpt",name:"ChatGPT",textAreaSelectors:["#prompt-textarea",'textarea[data-id="root"]','textarea[placeholder*="Message"]','div[contenteditable="true"][data-lexical-editor="true"]','div[contenteditable="true"]'],containerSelectors:["form.stretch",".relative.flex.h-full",'div[class*="composer"]',"form"],detectDarkMode(){if(document.documentElement.classList.contains("dark"))return!0;const e=getComputedStyle(document.body).backgroundColor,[o,r,s]=e.match(/\d+/g)?.map(Number)??[255,255,255];return(o+r+s)/3<128},getTextAreaValue(e){return e instanceof HTMLTextAreaElement?e.value:e.innerText??""},setTextAreaValue(e,o){e instanceof HTMLTextAreaElement?(e.value=o,Ye(e)):(e.focus(),document.execCommand("selectAll",!1),document.execCommand("insertText",!1,o))}},Ue={id:"claude",name:"Claude",textAreaSelectors:['div[contenteditable="true"].ProseMirror','div[contenteditable="true"][data-placeholder]','div[contenteditable="true"]',"textarea"],containerSelectors:["fieldset",'div[class*="input-area"]','div[class*="composer"]',"form"],detectDarkMode(){const e=document.documentElement;if(e.getAttribute("data-theme")==="dark"||e.classList.contains("dark")||document.body.classList.contains("dark"))return!0;const o=getComputedStyle(document.body).backgroundColor,[r,s,i]=o.match(/\d+/g)?.map(Number)??[255,255,255];return(r+s+i)/3<128},getTextAreaValue(e){return e.innerText??""},setTextAreaValue(e,o){e.focus(),document.execCommand("selectAll",!1),document.execCommand("insertText",!1,o),e.dispatchEvent(new Event("input",{bubbles:!0}))}},He={chatgpt:Ke,claude:Ue};function Qe(){const e=window.location.hostname;return e.includes("chatgpt.com")?"chatgpt":e.includes("claude.ai")?"claude":null}function Ge(e){return He[e]}function Je(e){for(const o of e.textAreaSelectors){const r=document.querySelector(o);if(r)return r}return null}const Xe=".container{width:100%}@media(min-width:640px){.container{max-width:640px}}@media(min-width:768px){.container{max-width:768px}}@media(min-width:1024px){.container{max-width:1024px}}@media(min-width:1280px){.container{max-width:1280px}}@media(min-width:1536px){.container{max-width:1536px}}.pointer-events-none{pointer-events:none}.visible{visibility:visible}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{inset:0}.-right-1{right:-.25rem}.-top-1{top:-.25rem}.bottom-2{bottom:.5rem}.bottom-4{bottom:1rem}.bottom-full{bottom:100%}.left-1\\/2{left:50%}.left-full{left:100%}.right-2{right:.5rem}.right-4{right:1rem}.top-4{top:1rem}.top-full{top:100%}.z-20{z-index:20}.z-50{z-index:50}.mx-auto{margin-left:auto;margin-right:auto}.mb-1{margin-bottom:.25rem}.mb-3{margin-bottom:.75rem}.mb-4{margin-bottom:1rem}.ml-3{margin-left:.75rem}.mt-0\\.5{margin-top:.125rem}.mt-1{margin-top:.25rem}.mt-2{margin-top:.5rem}.mt-4{margin-top:1rem}.block{display:block}.inline{display:inline}.flex{display:flex}.inline-flex{display:inline-flex}.grid{display:grid}.contents{display:contents}.hidden{display:none}.h-0\\.5{height:.125rem}.h-1{height:.25rem}.h-10{height:2.5rem}.h-12{height:3rem}.h-16{height:4rem}.h-2{height:.5rem}.h-3{height:.75rem}.h-4{height:1rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-64{height:16rem}.h-8{height:2rem}.h-\\[600px\\]{height:600px}.h-full{height:100%}.max-h-56{max-height:14rem}.max-h-60{max-height:15rem}.max-h-\\[600px\\]{max-height:600px}.min-h-\\[120px\\]{min-height:120px}.min-h-\\[200px\\]{min-height:200px}.min-h-screen{min-height:100vh}.w-1\\/2{width:50%}.w-10{width:2.5rem}.w-12{width:3rem}.w-16{width:4rem}.w-2{width:.5rem}.w-2\\/3{width:66.666667%}.w-3{width:.75rem}.w-3\\/4{width:75%}.w-4{width:1rem}.w-5{width:1.25rem}.w-8{width:2rem}.w-\\[400px\\]{width:400px}.w-\\[520px\\]{width:520px}.w-full{width:100%}.max-w-4xl{max-width:56rem}.max-w-md{max-width:28rem}.max-w-sm{max-width:24rem}.flex-1{flex:1 1 0%}.flex-shrink-0{flex-shrink:0}.-translate-x-1\\/2{--tw-translate-x: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-x-full{--tw-translate-x: -100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-full{--tw-translate-y: -100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-0{--tw-translate-x: 0px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-full{--tw-translate-x: 100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-0{--tw-translate-y: 0px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-full{--tw-translate-y: 100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-110{--tw-scale-x: 1.1;--tw-scale-y: 1.1;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(.4,0,.6,1) infinite}@keyframes spin{to{transform:rotate(360deg)}}.animate-spin{animation:spin 1s linear infinite}.cursor-pointer{cursor:pointer}.resize-none{resize:none}.resize{resize:both}.list-inside{list-style-position:inside}.list-decimal{list-style-type:decimal}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.flex-col{flex-direction:column}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-1{gap:.25rem}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.gap-5{gap:1.25rem}.gap-6{gap:1.5rem}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem * var(--tw-space-y-reverse))}.space-y-3>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.75rem * var(--tw-space-y-reverse))}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.space-y-6>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(2rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(2rem * var(--tw-space-y-reverse))}.overflow-hidden{overflow:hidden}.overflow-y-auto{overflow-y:auto}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.whitespace-nowrap{white-space:nowrap}.whitespace-pre-wrap{white-space:pre-wrap}.rounded{border-radius:.25rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:var(--radius)}.rounded-md{border-radius:calc(var(--radius) - 2px)}.rounded-xl{border-radius:.75rem}.border{border-width:1px}.border-2{border-width:2px}.border-4{border-width:4px}.border-b{border-bottom-width:1px}.border-t{border-top-width:1px}.border-amber-200{--tw-border-opacity: 1;border-color:rgb(253 230 138 / var(--tw-border-opacity, 1))}.border-blue-200{--tw-border-opacity: 1;border-color:rgb(191 219 254 / var(--tw-border-opacity, 1))}.border-blue-500{--tw-border-opacity: 1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.border-current{border-color:currentColor}.border-gray-200{--tw-border-opacity: 1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1))}.border-gray-300{--tw-border-opacity: 1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.border-gray-700{--tw-border-opacity: 1;border-color:rgb(55 65 81 / var(--tw-border-opacity, 1))}.border-green-200{--tw-border-opacity: 1;border-color:rgb(187 247 208 / var(--tw-border-opacity, 1))}.border-green-500{--tw-border-opacity: 1;border-color:rgb(34 197 94 / var(--tw-border-opacity, 1))}.border-red-200{--tw-border-opacity: 1;border-color:rgb(254 202 202 / var(--tw-border-opacity, 1))}.border-red-500{--tw-border-opacity: 1;border-color:rgb(239 68 68 / var(--tw-border-opacity, 1))}.border-transparent{border-color:transparent}.border-white{--tw-border-opacity: 1;border-color:rgb(255 255 255 / var(--tw-border-opacity, 1))}.border-t-blue-500{--tw-border-opacity: 1;border-top-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.border-t-gray-900{--tw-border-opacity: 1;border-top-color:rgb(17 24 39 / var(--tw-border-opacity, 1))}.border-t-white{--tw-border-opacity: 1;border-top-color:rgb(255 255 255 / var(--tw-border-opacity, 1))}.bg-amber-50{--tw-bg-opacity: 1;background-color:rgb(255 251 235 / var(--tw-bg-opacity, 1))}.bg-amber-500{--tw-bg-opacity: 1;background-color:rgb(245 158 11 / var(--tw-bg-opacity, 1))}.bg-black\\/50{background-color:#00000080}.bg-blue-100{--tw-bg-opacity: 1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.bg-blue-400{--tw-bg-opacity: 1;background-color:rgb(96 165 250 / var(--tw-bg-opacity, 1))}.bg-blue-50{--tw-bg-opacity: 1;background-color:rgb(239 246 255 / var(--tw-bg-opacity, 1))}.bg-blue-500{--tw-bg-opacity: 1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.bg-gray-100{--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}.bg-gray-200{--tw-bg-opacity: 1;background-color:rgb(229 231 235 / var(--tw-bg-opacity, 1))}.bg-gray-400{--tw-bg-opacity: 1;background-color:rgb(156 163 175 / var(--tw-bg-opacity, 1))}.bg-gray-50{--tw-bg-opacity: 1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.bg-gray-50\\/50{background-color:#f9fafb80}.bg-gray-700{--tw-bg-opacity: 1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}.bg-gray-800\\/50{background-color:#1f293780}.bg-gray-900{--tw-bg-opacity: 1;background-color:rgb(17 24 39 / var(--tw-bg-opacity, 1))}.bg-green-100{--tw-bg-opacity: 1;background-color:rgb(220 252 231 / var(--tw-bg-opacity, 1))}.bg-green-50{--tw-bg-opacity: 1;background-color:rgb(240 253 244 / var(--tw-bg-opacity, 1))}.bg-green-500{--tw-bg-opacity: 1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.bg-green-600{--tw-bg-opacity: 1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.bg-red-50{--tw-bg-opacity: 1;background-color:rgb(254 242 242 / var(--tw-bg-opacity, 1))}.bg-red-500{--tw-bg-opacity: 1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.bg-transparent{background-color:transparent}.bg-white{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.fill-current{fill:currentColor}.p-1{padding:.25rem}.p-10{padding:2.5rem}.p-12{padding:3rem}.p-3{padding:.75rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-0\\.5{padding-top:.125rem;padding-bottom:.125rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-1\\.5{padding-top:.375rem;padding-bottom:.375rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.pb-2{padding-bottom:.5rem}.pb-3{padding-bottom:.75rem}.pb-4{padding-bottom:1rem}.pr-1{padding-right:.25rem}.pt-1{padding-top:.25rem}.pt-3{padding-top:.75rem}.pt-5{padding-top:1.25rem}.text-left{text-align:left}.text-center{text-align:center}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.leading-relaxed{line-height:1.625}.leading-tight{line-height:1.25}.text-amber-700{--tw-text-opacity: 1;color:rgb(180 83 9 / var(--tw-text-opacity, 1))}.text-amber-800{--tw-text-opacity: 1;color:rgb(146 64 14 / var(--tw-text-opacity, 1))}.text-amber-900{--tw-text-opacity: 1;color:rgb(120 53 15 / var(--tw-text-opacity, 1))}.text-blue-600{--tw-text-opacity: 1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-blue-700{--tw-text-opacity: 1;color:rgb(29 78 216 / var(--tw-text-opacity, 1))}.text-blue-800{--tw-text-opacity: 1;color:rgb(30 64 175 / var(--tw-text-opacity, 1))}.text-gray-100{--tw-text-opacity: 1;color:rgb(243 244 246 / var(--tw-text-opacity, 1))}.text-gray-300{--tw-text-opacity: 1;color:rgb(209 213 219 / var(--tw-text-opacity, 1))}.text-gray-400{--tw-text-opacity: 1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity: 1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity: 1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity: 1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-gray-900{--tw-text-opacity: 1;color:rgb(17 24 39 / var(--tw-text-opacity, 1))}.text-green-600{--tw-text-opacity: 1;color:rgb(22 163 74 / var(--tw-text-opacity, 1))}.text-green-700{--tw-text-opacity: 1;color:rgb(21 128 61 / var(--tw-text-opacity, 1))}.text-green-800{--tw-text-opacity: 1;color:rgb(22 101 52 / var(--tw-text-opacity, 1))}.text-red-600{--tw-text-opacity: 1;color:rgb(220 38 38 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.underline{text-decoration-line:underline}.accent-blue-500{accent-color:#3b82f6}.opacity-0{opacity:0}.opacity-100{opacity:1}.opacity-50{opacity:.5}.opacity-60{opacity:.6}.shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-md{--tw-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);--tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-sm{--tw-shadow: 0 1px 2px 0 rgb(0 0 0 / .05);--tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.outline-none{outline:2px solid transparent;outline-offset:2px}.outline{outline-style:solid}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.delay-200{transition-delay:.2s}.delay-300{transition-delay:.3s}.duration-200{transition-duration:.2s}.duration-300{transition-duration:.3s}.duration-500{transition-duration:.5s}.ease-out{transition-timing-function:cubic-bezier(0,0,.2,1)}@keyframes enter{0%{opacity:var(--tw-enter-opacity, 1);transform:translate3d(var(--tw-enter-translate-x, 0),var(--tw-enter-translate-y, 0),0) scale3d(var(--tw-enter-scale, 1),var(--tw-enter-scale, 1),var(--tw-enter-scale, 1)) rotate(var(--tw-enter-rotate, 0))}}@keyframes exit{to{opacity:var(--tw-exit-opacity, 1);transform:translate3d(var(--tw-exit-translate-x, 0),var(--tw-exit-translate-y, 0),0) scale3d(var(--tw-exit-scale, 1),var(--tw-exit-scale, 1),var(--tw-exit-scale, 1)) rotate(var(--tw-exit-rotate, 0))}}.animate-in{animation-name:enter;animation-duration:.15s;--tw-enter-opacity: initial;--tw-enter-scale: initial;--tw-enter-rotate: initial;--tw-enter-translate-x: initial;--tw-enter-translate-y: initial}.fade-in{--tw-enter-opacity: 0}.zoom-in{--tw-enter-scale: 0}.slide-in-from-bottom-2{--tw-enter-translate-y: .5rem}.slide-in-from-bottom-4{--tw-enter-translate-y: 1rem}.slide-in-from-right-full{--tw-enter-translate-x: 100%}.slide-in-from-top{--tw-enter-translate-y: -100%}.duration-300{animation-duration:.3s}.duration-500{animation-duration:.5s}.delay-200{animation-delay:.2s}.delay-300{animation-delay:.3s}.ease-out{animation-timing-function:cubic-bezier(0,0,.2,1)}:host{box-sizing:border-box;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;font-size:14px;line-height:1.5;color-scheme:light dark}*,*:before,*:after{box-sizing:inherit}@keyframes pa-spin{to{transform:rotate(360deg)}}@keyframes pa-slide-up{0%{transform:translateY(1rem);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes pa-fade-in{0%{opacity:0}to{opacity:1}}.animate-spin{animation:pa-spin 1s linear infinite}.animate-in{animation:pa-slide-up .2s ease-out,pa-fade-in .2s ease-out}.slide-in-from-bottom-4{animation:pa-slide-up .2s ease-out}.slide-in-from-bottom-1{animation:pa-slide-up .15s ease-out}.fade-in{animation:pa-fade-in .2s ease-out}.duration-200{animation-duration:.2s}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#9ca3af80;border-radius:3px}input[type=range]{-webkit-appearance:none;-moz-appearance:none;appearance:none;height:6px;border-radius:3px;background:#374151;outline:none}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:#3b82f6;cursor:pointer}.hover\\:scale-110:hover{--tw-scale-x: 1.1;--tw-scale-y: 1.1;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\\:border-blue-500:hover{--tw-border-opacity: 1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.hover\\:border-green-500:hover{--tw-border-opacity: 1;border-color:rgb(34 197 94 / var(--tw-border-opacity, 1))}.hover\\:bg-blue-600:hover{--tw-bg-opacity: 1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.hover\\:bg-green-600:hover{--tw-bg-opacity: 1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.hover\\:bg-green-700:hover{--tw-bg-opacity: 1;background-color:rgb(21 128 61 / var(--tw-bg-opacity, 1))}.hover\\:bg-red-500:hover{--tw-bg-opacity: 1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.hover\\:text-amber-950:hover{--tw-text-opacity: 1;color:rgb(69 26 3 / var(--tw-text-opacity, 1))}.hover\\:text-blue-500:hover{--tw-text-opacity: 1;color:rgb(59 130 246 / var(--tw-text-opacity, 1))}.hover\\:text-blue-950:hover{--tw-text-opacity: 1;color:rgb(23 37 84 / var(--tw-text-opacity, 1))}.hover\\:text-gray-900:hover{--tw-text-opacity: 1;color:rgb(17 24 39 / var(--tw-text-opacity, 1))}.hover\\:text-green-950:hover{--tw-text-opacity: 1;color:rgb(5 46 22 / var(--tw-text-opacity, 1))}.hover\\:text-white:hover{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.hover\\:underline:hover{text-decoration-line:underline}.hover\\:opacity-80:hover{opacity:.8}.hover\\:shadow-lg:hover{--tw-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.hover\\:shadow-md:hover{--tw-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);--tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.focus\\:border-green-500:focus{--tw-border-opacity: 1;border-color:rgb(34 197 94 / var(--tw-border-opacity, 1))}.focus\\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\\:ring-2:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus\\:ring-blue-400:focus{--tw-ring-opacity: 1;--tw-ring-color: rgb(96 165 250 / var(--tw-ring-opacity, 1))}.focus\\:ring-blue-500:focus{--tw-ring-opacity: 1;--tw-ring-color: rgb(59 130 246 / var(--tw-ring-opacity, 1))}.focus\\:ring-green-500\\/20:focus{--tw-ring-color: rgb(34 197 94 / .2)}.focus\\:ring-offset-2:focus{--tw-ring-offset-width: 2px}.disabled\\:cursor-not-allowed:disabled{cursor:not-allowed}.disabled\\:opacity-50:disabled{opacity:.5}.group:hover .group-hover\\:text-blue-600{--tw-text-opacity: 1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.dark\\:border-amber-700:is(.dark *){--tw-border-opacity: 1;border-color:rgb(180 83 9 / var(--tw-border-opacity, 1))}.dark\\:border-blue-700:is(.dark *){--tw-border-opacity: 1;border-color:rgb(29 78 216 / var(--tw-border-opacity, 1))}.dark\\:border-gray-600:is(.dark *){--tw-border-opacity: 1;border-color:rgb(75 85 99 / var(--tw-border-opacity, 1))}.dark\\:border-gray-700:is(.dark *){--tw-border-opacity: 1;border-color:rgb(55 65 81 / var(--tw-border-opacity, 1))}.dark\\:border-gray-800:is(.dark *){--tw-border-opacity: 1;border-color:rgb(31 41 55 / var(--tw-border-opacity, 1))}.dark\\:border-green-700:is(.dark *){--tw-border-opacity: 1;border-color:rgb(21 128 61 / var(--tw-border-opacity, 1))}.dark\\:border-red-700:is(.dark *){--tw-border-opacity: 1;border-color:rgb(185 28 28 / var(--tw-border-opacity, 1))}.dark\\:bg-amber-900\\/20:is(.dark *){background-color:#78350f33}.dark\\:bg-blue-900\\/20:is(.dark *){background-color:#1e3a8a33}.dark\\:bg-blue-900\\/30:is(.dark *){background-color:#1e3a8a4d}.dark\\:bg-gray-700:is(.dark *){--tw-bg-opacity: 1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}.dark\\:bg-gray-800:is(.dark *){--tw-bg-opacity: 1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}.dark\\:bg-gray-900:is(.dark *){--tw-bg-opacity: 1;background-color:rgb(17 24 39 / var(--tw-bg-opacity, 1))}.dark\\:bg-green-900\\/10:is(.dark *){background-color:#14532d1a}.dark\\:bg-green-900\\/20:is(.dark *){background-color:#14532d33}.dark\\:bg-green-900\\/30:is(.dark *){background-color:#14532d4d}.dark\\:bg-red-900\\/20:is(.dark *){background-color:#7f1d1d33}.dark\\:text-amber-200:is(.dark *){--tw-text-opacity: 1;color:rgb(253 230 138 / var(--tw-text-opacity, 1))}.dark\\:text-amber-300:is(.dark *){--tw-text-opacity: 1;color:rgb(252 211 77 / var(--tw-text-opacity, 1))}.dark\\:text-amber-400:is(.dark *){--tw-text-opacity: 1;color:rgb(251 191 36 / var(--tw-text-opacity, 1))}.dark\\:text-blue-200:is(.dark *){--tw-text-opacity: 1;color:rgb(191 219 254 / var(--tw-text-opacity, 1))}.dark\\:text-blue-300:is(.dark *){--tw-text-opacity: 1;color:rgb(147 197 253 / var(--tw-text-opacity, 1))}.dark\\:text-gray-100:is(.dark *){--tw-text-opacity: 1;color:rgb(243 244 246 / var(--tw-text-opacity, 1))}.dark\\:text-gray-300:is(.dark *){--tw-text-opacity: 1;color:rgb(209 213 219 / var(--tw-text-opacity, 1))}.dark\\:text-gray-400:is(.dark *){--tw-text-opacity: 1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.dark\\:text-gray-700:is(.dark *){--tw-text-opacity: 1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.dark\\:text-green-200:is(.dark *){--tw-text-opacity: 1;color:rgb(187 247 208 / var(--tw-text-opacity, 1))}.dark\\:text-green-300:is(.dark *){--tw-text-opacity: 1;color:rgb(134 239 172 / var(--tw-text-opacity, 1))}.dark\\:text-green-500:is(.dark *){--tw-text-opacity: 1;color:rgb(34 197 94 / var(--tw-text-opacity, 1))}.dark\\:text-red-400:is(.dark *){--tw-text-opacity: 1;color:rgb(248 113 113 / var(--tw-text-opacity, 1))}.dark\\:text-white:is(.dark *){--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.dark\\:hover\\:text-amber-100:hover:is(.dark *){--tw-text-opacity: 1;color:rgb(254 243 199 / var(--tw-text-opacity, 1))}.dark\\:hover\\:text-blue-100:hover:is(.dark *){--tw-text-opacity: 1;color:rgb(219 234 254 / var(--tw-text-opacity, 1))}.dark\\:hover\\:text-green-100:hover:is(.dark *){--tw-text-opacity: 1;color:rgb(220 252 231 / var(--tw-text-opacity, 1))}.dark\\:hover\\:text-white:hover:is(.dark *){--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.group:hover .dark\\:group-hover\\:text-blue-400:is(.dark *){--tw-text-opacity: 1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}",S="[PromptArchitect]";console.log(`${S} Content script loaded on`,window.location.hostname);const V=Qe();V?(console.log(`${S} Site detected:`,V),Ze()):console.warn(`${S} Unsupported site, exiting.`);function Ze(){const e=Ge(V);let o=null,r=null,s=null,i=null,a=null;function n(g){const k=g.attachShadow({mode:"open"}),T=document.createElement("style");return T.textContent=Xe,k.appendChild(T),k}function d(g){if(!o)return;const k=e.detectDarkMode();o.render(t.jsx(K.StrictMode,{children:t.jsx(te,{onClick:v,isDark:k,hasText:g})}))}function c(g){if(!s)return;const k=e.detectDarkMode();console.log(`${S} Rendering overlay for topic:`,g||"(empty)"),s.render(t.jsx(K.StrictMode,{children:t.jsx(We,{topic:g,isDark:k,onClose:j,onReplaceText:p,onAppendText:b})}))}function l(){return a?e.getTextAreaValue(a):""}function p(g){a&&(l(),e.setTextAreaValue(a,g),a.focus?.())}function b(g){if(!a)return;const k=l(),T=k.trim()?`

---

`:"";e.setTextAreaValue(a,k+T+g),a.focus?.()}function y(){return i?(document.documentElement.contains(i)||(console.log(`${S} ⚠️ Overlay host detached — re-attaching to <html>`),document.documentElement.appendChild(i)),i):null}function v(){const g=l().trim(),k=y();k?(k.style.display="block",k.style.pointerEvents="auto",console.log(`${S} 🔓 Overlay host shown`)):console.warn(`${S} openOverlay: host not found`),c(g)}function j(){const g=y();g&&(g.style.display="none",g.style.pointerEvents="none"),s&&s.render(t.jsx(t.Fragment,{}))}function f(){if(!r||!a)return;const g=a.getBoundingClientRect();g.width!==0&&Object.assign(r.style,{top:`${g.top+8}px`,left:`${g.right-48}px`})}function A(g){if(r&&document.documentElement.contains(r)){console.log(`${S} Button already injected, skipping.`);return}console.log(`${S} Injecting Refine button (fixed position)`),r=document.createElement("div"),r.id="prompt-architect-refine-btn",Object.assign(r.style,{position:"fixed",zIndex:"2147483647",pointerEvents:"all",width:"40px",height:"40px"}),document.documentElement.appendChild(r);const k=n(r),T=document.createElement("div");k.appendChild(T),o=Y.createRoot(T),a=g,f(),d(l().trim().length>0),window.addEventListener("scroll",f,{passive:!0}),window.addEventListener("resize",f,{passive:!0}),g.addEventListener("input",()=>{d(l().trim().length>0)}),console.log(`${S} ✅ Refine button mounted`)}function u(){if(s)return;const g=document.createElement("div");g.id="prompt-architect-overlay-host",Object.assign(g.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",zIndex:"2147483647",pointerEvents:"none",display:"none"}),document.documentElement.appendChild(g),i=g;const k=n(g),T=document.createElement("div");T.id="prompt-architect-overlay-mount",T.style.cssText="position:relative;width:100%;height:100%;pointer-events:none;",k.appendChild(T),s=Y.createRoot(T),console.log(`${S} ✅ Overlay host mounted`)}let C=null;function P(){const g=Je(e);if(!g){console.log(`${S} No textarea found yet, waiting...`);return}if(g===a&&r&&document.documentElement.contains(r)){f();return}console.log(`${S} Textarea found:`,g.tagName,g.id||g.className?.slice?.(0,40)),A(g)}const O=new MutationObserver(()=>{C&&clearTimeout(C),C=setTimeout(P,500)});function q(){console.log(`${S} 🚀 Booting...`),u(),P(),O.observe(document.body,{childList:!0,subtree:!0}),console.log(`${S} MutationObserver active`)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",q):q()}
